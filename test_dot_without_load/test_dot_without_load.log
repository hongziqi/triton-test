============================= test session starts ==============================
platform linux -- Python 3.10.18, pytest-8.3.2, pluggy-1.6.0 -- /home/coder/miniconda/envs/triton/bin/python3.10
cachedir: .pytest_cache
rootdir: /home/coder/workspace/triton-test
plugins: xdist-3.6.1
collecting ... collected 2 items

language/test_core.py::test_dot_without_load[float32] FAILED
language/test_core.py::test_dot_without_load[float16] FAILED

=================================== FAILURES ===================================
________________________ test_dot_without_load[float32] ________________________

dtype_str = 'float32', device = 'npu'

    @pytest.mark.interpreter
    @pytest.mark.parametrize("dtype_str", ['float32', 'float16'])
    def test_dot_without_load(dtype_str, device):
    
        @triton.jit
        def _kernel(out):
            a = GENERATE_TEST_HERE
            b = GENERATE_TEST_HERE
            c = tl.dot(a, b)
            out_ptr = out + tl.arange(0, 32)[:, None] * 32 + tl.arange(0, 32)[None, :]
            tl.store(out_ptr, c)
    
        kernel = patch_kernel(_kernel, {'GENERATE_TEST_HERE': f"tl.full((32, 32), 1.0, tl.{dtype_str})"})
        a = torch.ones((32, 32), dtype=getattr(torch, dtype_str), device=device)
        b = torch.ones((32, 32), dtype=getattr(torch, dtype_str), device=device)
        out_ref = torch.matmul(a, b)
        out = torch.zeros((32, 32), dtype=getattr(torch, dtype_str), device=device)
        kernel[(1, )](out)
>       assert torch.all(out == out_ref)
E       AssertionError: assert tensor(False, device='npu:0')
E        +  where tensor(False, device='npu:0') = <built-in method all of type object at 0xfffefa898418>(tensor([[0., ...evice='npu:0') == tensor([[32.,...evice='npu:0')
E        +    where <built-in method all of type object at 0xfffefa898418> = torch.all
E           
E           Full diff:
E           - tensor([[32., 32., 32.,  ..., 32., 32., 32.],
E           ?          ^^   ^^   ^^         ^^   ^^   ^^
E           + tensor([[0., 0., 0.,  ..., 0., 0., 0.],
E           ?          ^   ^   ^         ^   ^   ^
E           -         [32., 32., 32.,  ..., 32., 32., 32.],...
E           
E           ...Full output truncated (20 lines hidden), use '-vv' to show)

language/test_core.py:3845: AssertionError
________________________ test_dot_without_load[float16] ________________________

dtype_str = 'float16', device = 'npu'

    @pytest.mark.interpreter
    @pytest.mark.parametrize("dtype_str", ['float32', 'float16'])
    def test_dot_without_load(dtype_str, device):
    
        @triton.jit
        def _kernel(out):
            a = GENERATE_TEST_HERE
            b = GENERATE_TEST_HERE
            c = tl.dot(a, b)
            out_ptr = out + tl.arange(0, 32)[:, None] * 32 + tl.arange(0, 32)[None, :]
            tl.store(out_ptr, c)
    
        kernel = patch_kernel(_kernel, {'GENERATE_TEST_HERE': f"tl.full((32, 32), 1.0, tl.{dtype_str})"})
        a = torch.ones((32, 32), dtype=getattr(torch, dtype_str), device=device)
        b = torch.ones((32, 32), dtype=getattr(torch, dtype_str), device=device)
        out_ref = torch.matmul(a, b)
        out = torch.zeros((32, 32), dtype=getattr(torch, dtype_str), device=device)
        kernel[(1, )](out)
>       assert torch.all(out == out_ref)
E       AssertionError: assert tensor(False, device='npu:0')
E        +  where tensor(False, device='npu:0') = <built-in method all of type object at 0xfffefa898418>(tensor([[0., ...torch.float16) == tensor([[32.,...torch.float16)
E        +    where <built-in method all of type object at 0xfffefa898418> = torch.all
E           
E           Full diff:
E           - tensor([[32., 32., 32.,  ..., 32., 32., 32.],
E           ?          ^^   ^^   ^^         ^^   ^^   ^^
E           + tensor([[0., 0., 0.,  ..., 0., 0., 0.],
E           ?          ^   ^   ^         ^   ^   ^
E           -         [32., 32., 32.,  ..., 32., 32., 32.],...
E           
E           ...Full output truncated (19 lines hidden), use '-vv' to show)

language/test_core.py:3845: AssertionError
=========================== short test summary info ============================
FAILED language/test_core.py::test_dot_without_load[float32] - AssertionError...
FAILED language/test_core.py::test_dot_without_load[float16] - AssertionError...
============================== 2 failed in 15.90s ==============================
